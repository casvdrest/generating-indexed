{-# OPTIONS --type-in-type #-}

open import Data.Nat
open import Data.Char
open import Data.List
open import Data.Product
open import Data.Unit hiding (_â‰Ÿ_)

open import Relation.Nullary
open import Relation.Binary.PropositionalEquality 

open import Level

open import AgdaGen.Base renaming (Î¼ to Î¼B)
open import AgdaGen.Combinators

open import AgdaGen.Generic.Isomorphism

open import AgdaGen.Generic.Indexed.IDesc.Universe
open import AgdaGen.Generic.Indexed.IDesc.Generator

module AgdaGen.Generic.Indexed.IDesc.SystemF where

  open GFunctor â¦ƒ...â¦„
  open GApplicative â¦ƒ...â¦„
  open GMonad â¦ƒ...â¦„
  open GAlternative â¦ƒ...â¦„
  open GNullable â¦ƒ...â¦„

  Id : Set
  Id = â„•

  data ğ•‹ : Set where
    ``_  : Id â†’ ğ•‹
    _`â†’_ : ğ•‹ â†’ ğ•‹ â†’ ğ•‹
    `âˆ€_Â·_  : Id â†’ ğ•‹ â†’ ğ•‹
    
  data Î»2 : Set where
    `_   : Id â†’ Î»2
    _Â·_  : Î»2 â†’ Î»2 â†’ Î»2
    Æ›_â‡’_ : Id â†’ Î»2 â†’ Î»2
 
  data Ctx : Set where
    âˆ… : Ctx
    _,_âˆ¶_ : Ctx â†’ Id â†’ ğ•‹ â†’ Ctx

  data _âˆ‹_ : Ctx â†’ ğ•‹ â†’ Set where
  
    [Top] : âˆ€ {Î“ Ï„ Î±}
          -----------------
          â†’ (Î“ , Î± âˆ¶ Ï„) âˆ‹ Ï„
    
    [Pop] : âˆ€ {Î“ Ïƒ Ï„ Î²} â†’ Î“ âˆ‹ Ï„
          ---------------------
          â†’ (Î“ , Î² âˆ¶ Ïƒ) âˆ‹ Ï„

  CtxD : func 0â„“ (Ctx Ã— ğ•‹) (Ctx Ã— ğ•‹)
  CtxD = func.mk Î»
    { (âˆ… , Ï„) â†’ `Ïƒ 0 Î»()
    ; (Î“ , x âˆ¶ Ïƒ , Ï„) â†’ `Ïƒ 2 Î»
        { âˆ™     â†’ `Î£ (Ïƒ â‰¡ Ï„) Î» { refl â†’ `1 } -- top 
        ; (â–» âˆ™) â†’ `var (Î“ , Ï„)
        }
    }

  fromCtx : âˆ€ {Î“ Ï„} â†’ Î“ âˆ‹ Ï„ â†’ Î¼ CtxD (Î“ , Ï„)
  fromCtx {.(_ , _ âˆ¶ Ï„)} {Ï„} [Top]     = âŸ¨ (âˆ™ , refl , lift tt) âŸ©
  fromCtx {.(_ , _ âˆ¶ _)} {Ï„} ([Pop] p) = âŸ¨ ((â–» âˆ™) , (fromCtx p)) âŸ©

  toCtx : âˆ€ {Î“ Ï„} â†’ Î¼ CtxD (Î“ , Ï„) â†’ Î“ âˆ‹ Ï„
  toCtx {Î“ , x âˆ¶ Ïƒ} {.Ïƒ} âŸ¨ âˆ™ , refl , lift tt âŸ© = [Top]
  toCtx {Î“ , x âˆ¶ Ïƒ} {Ï„} âŸ¨ â–» âˆ™ , snd âŸ©           = [Pop] (toCtx snd)

  Ctx-isoâ‚ : âˆ€ {Î“ Ï„} {p : Î“ âˆ‹ Ï„} â†’ toCtx (fromCtx p) â‰¡ p
  Ctx-isoâ‚ {.(_ , _ âˆ¶ Ï„)} {Ï„} {[Top]} = refl
  Ctx-isoâ‚ {.(_ , _ âˆ¶ _)} {Ï„} {[Pop] p} = cong [Pop] Ctx-isoâ‚

  Ctx-isoâ‚‚ : âˆ€ {Î“ Ï„} {p : Î¼ CtxD (Î“ , Ï„)} â†’ fromCtx (toCtx p) â‰¡ p
  Ctx-isoâ‚‚ {Î“ , xâ‚ âˆ¶ xâ‚‚} {.xâ‚‚} {âŸ¨ âˆ™ , refl , lift tt âŸ©} = refl
  Ctx-isoâ‚‚ {Î“ , xâ‚ âˆ¶ xâ‚‚} {Ï„} {âŸ¨ â–» âˆ™ , snd âŸ©}            = cong (Î» x â†’ âŸ¨ (â–» âˆ™) , x âŸ©) Ctx-isoâ‚‚

  instance
    Ctxâ‰…IDesc : â‰…IDesc {I = Ctx Ã— ğ•‹} Î» { (Î“ , Ï„) â†’ Î“ âˆ‹ Ï„ }
    Ctxâ‰…IDesc = record
      { W = CtxD
      , â‰…-transitive (â‰…-symmetric â‰…lift) (record
          { from = fromCtx
          ; to   = toCtx
          ; isoâ‚ = Ctx-isoâ‚
          ; isoâ‚‚ = Ctx-isoâ‚‚
          })
      }

  data _âˆŒâ‚œ_ : ğ•‹ â†’ Id â†’ Set where

   [âˆŒâ‚œ-var] : âˆ€ {Î± Î²} â†’ Â¬ Î± â‰¡ Î²
            ---------------------
            â†’ (`` Î²) âˆŒâ‚œ Î±

   [âˆŒâ‚œ-fty] : âˆ€ {Î± Ï„â‚ Ï„â‚‚} â†’ Ï„â‚ âˆŒâ‚œ Î± â†’ Ï„â‚‚ âˆŒâ‚œ Î±
            ---------------------------------
            â†’ (Ï„â‚ `â†’ Ï„â‚‚) âˆŒâ‚œ Î±

   [âˆŒâ‚œ-âˆ€Â¬â‰¡] : âˆ€ {Î± Î² Ï„} â†’ Â¬ Î± â‰¡ Î² â†’ Ï„ âˆŒâ‚œ Î±
            ------------------------------
            â†’ (`âˆ€ Î² Â· Ï„) âˆŒâ‚œ Î±

   [âˆŒâ‚œ-âˆ€â‰¡]  : âˆ€ {Î± Ï„}
            -----------------
            â†’ (`âˆ€ Î± Â· Ï„) âˆŒâ‚œ Î±

  âˆŒâ‚œD : func 0â„“ (ğ•‹ Ã— Id) (ğ•‹ Ã— Id)
  âˆŒâ‚œD = func.mk Î»
    { ((`` Î²) , Î±) â†’ `Î£ (Â¬ Î± â‰¡ Î²) Î» _ â†’ `1
    ; ((Ï„â‚ `â†’ Ï„â‚‚) , Î±) â†’ `var (Ï„â‚ , Î±) `Ã— `var (Ï„â‚‚ , Î±)
    ; ((`âˆ€ Î² Â· Ï„) , Î±) â†’ `Ïƒ 2 Î»
        { âˆ™     â†’ `Î£ (Â¬ Î± â‰¡ Î²) Î» _ â†’ `var (Ï„ , Î±)
        ; (â–» âˆ™) â†’ `Î£ (Î± â‰¡ Î²) Î» { refl â†’ `1 }
        }
    }

  fromâˆŒâ‚œ : âˆ€ {Ï„ Î±} â†’ Ï„ âˆŒâ‚œ Î± â†’ Î¼ âˆŒâ‚œD (Ï„ , Î±)
  fromâˆŒâ‚œ {.(`` _)} {Î±} ([âˆŒâ‚œ-var] x) =
    âŸ¨ x , lift tt âŸ©
  fromâˆŒâ‚œ {.(_ `â†’ _)} {Î±} ([âˆŒâ‚œ-fty] p pâ‚) =
    âŸ¨ (fromâˆŒâ‚œ p , fromâˆŒâ‚œ pâ‚) âŸ©
  fromâˆŒâ‚œ {.(`âˆ€ _ Â· _)} {Î±} ([âˆŒâ‚œ-âˆ€Â¬â‰¡] x p) =
    âŸ¨ (âˆ™ , (x , fromâˆŒâ‚œ p)) âŸ©
  fromâˆŒâ‚œ {.(`âˆ€ Î± Â· _)} {Î±} [âˆŒâ‚œ-âˆ€â‰¡] =
    âŸ¨ ((â–» âˆ™) , (refl , lift tt)) âŸ©

  toâˆŒâ‚œ : âˆ€ {Ï„ Î±} â†’ Î¼ âˆŒâ‚œD (Ï„ , Î±) â†’ Ï„ âˆŒâ‚œ Î±
  toâˆŒâ‚œ {`` xâ‚} {Î±} âŸ¨ fst , lift tt âŸ© =
    [âˆŒâ‚œ-var] fst
  toâˆŒâ‚œ {Ï„ `â†’ Ï„â‚} {Î±} âŸ¨ fst , snd âŸ© =
    [âˆŒâ‚œ-fty] (toâˆŒâ‚œ fst) (toâˆŒâ‚œ snd)
  toâˆŒâ‚œ {`âˆ€ xâ‚ Â· Ï„} {Î±} âŸ¨ âˆ™ , fst , snd âŸ© =
    [âˆŒâ‚œ-âˆ€Â¬â‰¡] fst (toâˆŒâ‚œ snd)
  toâˆŒâ‚œ {`âˆ€ xâ‚ Â· Ï„} {.xâ‚} âŸ¨ â–» âˆ™ , refl , snd âŸ© =
    [âˆŒâ‚œ-âˆ€â‰¡]

  âˆŒâ‚œ-isoâ‚ : âˆ€ {Ï„ Î±} {p : Ï„ âˆŒâ‚œ Î±} â†’ toâˆŒâ‚œ (fromâˆŒâ‚œ p) â‰¡ p
  âˆŒâ‚œ-isoâ‚ {`` x} {Î±} {[âˆŒâ‚œ-var] xâ‚} = refl
  âˆŒâ‚œ-isoâ‚ {Ï„ `â†’ Ï„â‚} {Î±} {[âˆŒâ‚œ-fty] p pâ‚} =
    congâ‚‚ [âˆŒâ‚œ-fty] âˆŒâ‚œ-isoâ‚ âˆŒâ‚œ-isoâ‚
  âˆŒâ‚œ-isoâ‚ {`âˆ€ x Â· Ï„} {Î±} {[âˆŒâ‚œ-âˆ€Â¬â‰¡] xâ‚ p} =
    cong ([âˆŒâ‚œ-âˆ€Â¬â‰¡] xâ‚) âˆŒâ‚œ-isoâ‚
  âˆŒâ‚œ-isoâ‚ {`âˆ€ x Â· Ï„} {.x} {[âˆŒâ‚œ-âˆ€â‰¡]} = refl

  âˆŒâ‚œ-isoâ‚‚ : âˆ€ {Ï„ Î±} {p : Î¼ âˆŒâ‚œD (Ï„ , Î±)} â†’ fromâˆŒâ‚œ (toâˆŒâ‚œ p) â‰¡ p
  âˆŒâ‚œ-isoâ‚‚ {`` x} {Î±} {âŸ¨ fst , lift tt âŸ©} = refl
  âˆŒâ‚œ-isoâ‚‚ {Ï„ `â†’ Ï„â‚} {Î±} {âŸ¨ fst , snd âŸ©} =
    congâ‚‚ (Î» x y â†’ âŸ¨ x , y âŸ©) âˆŒâ‚œ-isoâ‚‚ âˆŒâ‚œ-isoâ‚‚
  âˆŒâ‚œ-isoâ‚‚ {`âˆ€ x Â· Ï„} {Î±} {âŸ¨ âˆ™ , fst , snd âŸ©} =
    cong (Î» x â†’ âŸ¨ (âˆ™ , fst , x) âŸ©) âˆŒâ‚œ-isoâ‚‚
  âˆŒâ‚œ-isoâ‚‚ {`âˆ€ x Â· Ï„} {.x} {âŸ¨ â–» âˆ™ , refl , lift tt âŸ©} = refl

  instance
    âˆŒâ‚œâ‰…IDesc : â‰…IDesc {I = ğ•‹ Ã— Id} Î» { (Ï„ , Î±) â†’ Ï„ âˆŒâ‚œ Î± }
    âˆŒâ‚œâ‰…IDesc = record
      { W = âˆŒâ‚œD
      , â‰…-transitive (â‰…-symmetric â‰…lift) (record
        { from = fromâˆŒâ‚œ
        ; to   = toâˆŒâ‚œ 
        ; isoâ‚ = âˆŒâ‚œ-isoâ‚
        ; isoâ‚‚ = âˆŒâ‚œ-isoâ‚‚ }) }

  data _âˆŒ_ : Ctx â†’ Id â†’ Set where
  
    [âˆŒâ‚] : âˆ€ {Î±}
         -------
         â†’ âˆ… âˆŒ Î±
    
    [âˆŒâ‚‚] : âˆ€ {Î“ Î± x Ï„} â†’ Î“ âˆŒ Î± â†’ Ï„ âˆŒâ‚œ Î±
         ------------------------------
         â†’ (Î“ , x âˆ¶ Ï„) âˆŒ Î± 

  âˆŒD : func 0â„“ (Ctx Ã— Id) (Ctx Ã— Id)
  âˆŒD = func.mk Î»
    { (âˆ… , Î±) â†’ `1
    ; ((Î“ , x âˆ¶ Ï„) , Î±) â†’ `Î£ (Ï„ âˆŒâ‚œ Î±) Î» _ â†’ `var (Î“ , Î±)
    }

  fromâˆŒ : âˆ€ {Î“ Î±} â†’ Î“ âˆŒ Î± â†’ Î¼ âˆŒD (Î“ , Î±)
  fromâˆŒ {.âˆ…} {Î±} [âˆŒâ‚]                 = âŸ¨ lift tt âŸ©
  fromâˆŒ {.(_ , _ âˆ¶ _)} {Î±} ([âˆŒâ‚‚] p x) = âŸ¨ x , fromâˆŒ p âŸ©

  toâˆŒ : âˆ€ {Î“ Î±} â†’ Î¼ âˆŒD (Î“ , Î±) â†’ Î“ âˆŒ Î±
  toâˆŒ {âˆ…} {Î±} âŸ¨ lift tt âŸ©             = [âˆŒâ‚]
  toâˆŒ {Î“ , xâ‚ âˆ¶ xâ‚‚} {Î±} âŸ¨ fst , snd âŸ© = [âˆŒâ‚‚] (toâˆŒ snd) fst

  âˆŒ-isoâ‚ : âˆ€ {Î“ Î±} {p : Î“ âˆŒ Î±} â†’ toâˆŒ (fromâˆŒ p) â‰¡ p
  âˆŒ-isoâ‚ {.âˆ…} {Î±} {[âˆŒâ‚]}               = refl
  âˆŒ-isoâ‚ {.(_ , _ âˆ¶ _)} {Î±} {[âˆŒâ‚‚] p x} = cong (Î» p â†’ [âˆŒâ‚‚] p x) âˆŒ-isoâ‚

  âˆŒ-isoâ‚‚ : âˆ€ {Î“ Î±} {p : Î¼ âˆŒD (Î“ , Î±)} â†’ fromâˆŒ (toâˆŒ p) â‰¡ p
  âˆŒ-isoâ‚‚ {âˆ…} {Î±} {âŸ¨ lift tt âŸ©}           = refl
  âˆŒ-isoâ‚‚ {Î“ , x âˆ¶ Ï„} {Î±} {âŸ¨ fst , snd âŸ©} = cong (Î» p â†’ âŸ¨ fst , p âŸ©) âˆŒ-isoâ‚‚

  instance
    âˆŒâ‰…IDesc : â‰…IDesc {I = Ctx Ã— Id} Î» { (Î“ , Î±) â†’ Î“ âˆŒ Î± }
    âˆŒâ‰…IDesc = record
      { W = âˆŒD
      , â‰…-transitive (â‰…-symmetric â‰…lift) (record
        { from = fromâˆŒ
        ; to   = toâˆŒ
        ; isoâ‚ = âˆŒ-isoâ‚
        ; isoâ‚‚ = âˆŒ-isoâ‚‚
        }) }

  _[_:=_] : ğ•‹ â†’ Id â†’ ğ•‹ â†’ ğ•‹
  (`` Î²) [ Î± := Ï„ ] with Î± â‰Ÿ Î²
  ... | (yes Î±â‰¡Î²) = Ï„
  ... | (no Â¬Î±â‰¡Î²) = `` Î²
  (Ïƒâ‚ `â†’ Ïƒâ‚‚) [ Î± := Ï„ ] = (Ïƒâ‚ [ Î± := Ï„ ]) `â†’ (Ïƒâ‚‚ [ Î± := Ï„ ]) 
  (`âˆ€ Î² Â· Ïƒ) [ Î± := Ï„ ] with Î± â‰Ÿ Î²
  ... | (yes Î±â‰¡Î²) = `âˆ€ Î² Â· Ïƒ
  ... | (no Â¬Î±â‰¡Î²) = `âˆ€ Î² Â· (Ïƒ [ Î± := Ï„ ])
 
  infix 10 _âŠ¢_
  infix 15 _,_âˆ¶_

  data _âŠ¢_ : Ctx â†’ ğ•‹ â†’ Set where

    [Î»2-var] : âˆ€ {Î“ Ïƒ} â†’ Î“ âˆ‹ Ïƒ
             -----------------
             â†’ Î“ âŠ¢ Ïƒ

    [Î»2-app] : âˆ€ {Î“ Ïƒ Ï„} â†’ Î“ âŠ¢ (Ïƒ `â†’ Ï„) â†’ Î“ âŠ¢ Ïƒ
             ----------------------------------
             â†’ Î“ âŠ¢ Ï„

    [Î»2-abs] : âˆ€ {Î“ x Ïƒ Ï„} â†’ (Î“ , x âˆ¶ Ïƒ) âŠ¢ Ï„
             -------------------------------
             â†’ Î“ âŠ¢ (Ïƒ `â†’ Ï„)

    [Î»2-âˆ€â‚]  : âˆ€ {Î“ Î± Ïƒ Ï„} â†’ Î“ âŠ¢ (`âˆ€ Î± Â· Ïƒ)
             ------------------------------
             â†’ Î“ âŠ¢ (Ïƒ [ Î± := Ï„ ])

    [Î»2-âˆ€â‚‚]  : âˆ€ {Î“ Î± Ïƒ} â†’ Î“ âŠ¢ Ïƒ â†’ Î“ âˆŒ Î± 
             ---------------------------
             â†’ Î“ âŠ¢ ( `âˆ€ Î± Â· Ïƒ)


  Î»2D : func 0â„“ (Ctx Ã— ğ•‹) (Ctx Ã— ğ•‹)
  Î»2D = func.mk Î»
    { (Î“ , Ï„) â†’ `Ïƒ 5
        Î» { âˆ™           â†’ `Î£ (Î“ âˆ‹ Ï„) Î» _ â†’ `1
          ; (â–» âˆ™)       â†’ `Î£ ğ•‹ Î» Ïƒ â†’ `var (Î“ , Ïƒ `â†’ Ï„) `Ã— `var (Î“ , Ïƒ)
          ; (â–» â–» âˆ™)     â†’ `Î£ (Î£ (ğ•‹ Ã— ğ•‹) Î» { (Ï„â‚ , Ï„â‚‚) â†’ Ï„ â‰¡ Ï„â‚ `â†’ Ï„â‚‚ })
                            Î» { ((Ï„â‚ , Ï„â‚‚) , refl) â†’ `Î£ Id Î» Î± â†’ `var (Î“ , Î± âˆ¶ Ï„â‚ , Ï„â‚‚) } 
          ; (â–» â–» â–» âˆ™)   â†’ `Î£ (Î£ (ğ•‹ Ã— Id Ã— ğ•‹) Î» { (Ïƒ , Î± , Ï„') â†’ Ï„ â‰¡ (Ïƒ [ Î± := Ï„' ]) })
                            Î» { ((Ïƒ , Î± , Ï„') , refl) â†’ `var (Î“ , (`âˆ€ Î± Â· Ïƒ)) }
          ; (â–» â–» â–» â–» âˆ™) â†’ `Î£ (Î£ (Id Ã— ğ•‹) Î» { (Î± , Ïƒ) â†’ Ï„ â‰¡ (`âˆ€ Î± Â· Ïƒ) })
                            Î» { ((Î± , Ïƒ) , refl) â†’ `Î£ (Î“ âˆŒ Î±) Î» _ â†’ `var (Î“ , Ïƒ) } 
          } }

  fromÎ»2 : âˆ€ {Î“ Ï„} â†’ Î“ âŠ¢ Ï„ â†’ Î¼ Î»2D (Î“ , Ï„)
  fromÎ»2 ([Î»2-var] x) =
    âŸ¨ (âˆ™ , x , lift tt) âŸ©
  fromÎ»2 ([Î»2-app] {Ïƒ = Ïƒ} p pâ‚) =
    âŸ¨ ((â–» âˆ™) , Ïƒ , fromÎ»2 p , fromÎ»2 pâ‚) âŸ©
  fromÎ»2 {Ï„ = Ï„â‚ `â†’ Ï„â‚‚} ([Î»2-abs] {x = x} p) =
    âŸ¨ ((â–» â–» âˆ™) , ((Ï„â‚ , Ï„â‚‚) , refl) , x , fromÎ»2 p) âŸ©
  fromÎ»2 {Ï„ = .(Ïƒ [ Î± := Ï„ ])} ([Î»2-âˆ€â‚] {Î± = Î±} {Ïƒ = Ïƒ} {Ï„ = Ï„} p) =
    âŸ¨ (â–» â–» â–» âˆ™ , ((Ïƒ , Î± , Ï„) , refl) , fromÎ»2 p) âŸ©
  fromÎ»2 {Ï„ = `âˆ€ Î± Â· Ïƒ} ([Î»2-âˆ€â‚‚] p x) =
    âŸ¨ ((â–» â–» â–» â–» âˆ™) , ((Î± , Ïƒ) , refl) , x , fromÎ»2 p) âŸ©

  toÎ»2 : âˆ€ {Î“ Ï„} â†’ Î¼ Î»2D (Î“ , Ï„) â†’ Î“ âŠ¢ Ï„
  toÎ»2 {Î“} {Ï„} âŸ¨ âˆ™ , fst , lift tt âŸ© =
    [Î»2-var] fst
  toÎ»2 {Î“} {Ï„} âŸ¨ â–» âˆ™ , fst , fstâ‚ , snd âŸ© =
    [Î»2-app] (toÎ»2 fstâ‚) (toÎ»2 snd)
  toÎ»2 {Î“} {.(Ï„â‚ `â†’ Ï„â‚‚)} âŸ¨ â–» â–» âˆ™ , ((Ï„â‚ , Ï„â‚‚) , refl) , Î± , snd âŸ© =
    [Î»2-abs] (toÎ»2 snd)
  toÎ»2 {Î“} {.(Ïƒ [ Î± := Ï„' ])} âŸ¨ â–» â–» â–» âˆ™ , ((Ïƒ , Î± , Ï„') , refl) , snd âŸ© =
    [Î»2-âˆ€â‚] (toÎ»2 snd)
  toÎ»2 {Î“} {.(`âˆ€ Î± Â· Ïƒ)} âŸ¨ â–» â–» â–» â–» âˆ™ , ((Î± , Ïƒ) , refl) , fst , snd âŸ© =
    [Î»2-âˆ€â‚‚] (toÎ»2 snd) fst

  Î»2-isoâ‚ : âˆ€ {Î“ Ï„} {p : Î“ âŠ¢ Ï„} â†’ toÎ»2 (fromÎ»2 p) â‰¡ p
  Î»2-isoâ‚ {Î“} {Ï„} {[Î»2-var] x} = refl
  Î»2-isoâ‚ {Î“} {Ï„} {[Î»2-app] p pâ‚} =
    congâ‚‚ [Î»2-app] Î»2-isoâ‚ Î»2-isoâ‚
  Î»2-isoâ‚ {Î“} {(Ïƒ `â†’ Ï„)} {[Î»2-abs] p} =
    cong [Î»2-abs] Î»2-isoâ‚
  Î»2-isoâ‚ {Î“} {Ï„} {[Î»2-âˆ€â‚] p} =
    cong [Î»2-âˆ€â‚] Î»2-isoâ‚
  Î»2-isoâ‚ {Î“} {(`âˆ€ Î± Â· Ïƒ)} {[Î»2-âˆ€â‚‚] p x} =
    cong (Î» p â†’ [Î»2-âˆ€â‚‚] p x) Î»2-isoâ‚

  Î»2-isoâ‚‚ : âˆ€ {Î“ Ï„} {p : Î¼ Î»2D (Î“ , Ï„)} â†’ fromÎ»2 (toÎ»2 p) â‰¡ p
  Î»2-isoâ‚‚ {Î“} {Ï„} {âŸ¨ âˆ™ , fst , lift tt âŸ©} = refl
  Î»2-isoâ‚‚ {Î“} {Ï„} {âŸ¨ â–» âˆ™ , Ïƒ , fst , snd âŸ©} =
    congâ‚‚ (Î» x y â†’ âŸ¨ ((â–» âˆ™) , Ïƒ , x , y) âŸ©) Î»2-isoâ‚‚ Î»2-isoâ‚‚
  Î»2-isoâ‚‚ {Î“} {.(Ï„â‚ `â†’ Ï„â‚‚)} {âŸ¨ â–» â–» âˆ™ , ((Ï„â‚ , Ï„â‚‚) , refl) , Î± , snd âŸ©} =
    cong (Î» x â†’ âŸ¨ (â–» â–» âˆ™ , ((Ï„â‚ , Ï„â‚‚) , refl) , Î± , x) âŸ©) Î»2-isoâ‚‚
  Î»2-isoâ‚‚ {Î“} {.(Ïƒ [ Î± := Ï„' ])} {âŸ¨ â–» â–» â–» âˆ™ , ((Ïƒ , Î± , Ï„') , refl) , sndâ‚ âŸ©} =
    cong (Î» x â†’ âŸ¨ ((â–» â–» â–» âˆ™) , ((Ïƒ , Î± , Ï„') , refl) , x) âŸ©) Î»2-isoâ‚‚
  Î»2-isoâ‚‚ {Î“} {.(`âˆ€ Î± Â· Ïƒ)} {âŸ¨ â–» â–» â–» â–» âˆ™ , ((Î± , Ïƒ) , refl) , fst , snd âŸ©} =
    cong (Î» x â†’ âŸ¨ ((â–» â–» â–» â–» âˆ™) , ((Î± , Ïƒ) , refl) , fst , x) âŸ©) Î»2-isoâ‚‚

  instance
   Î»2-â‰…IDesc : â‰…IDesc {I = Ctx Ã— ğ•‹} (Î» { (Î“ , Ï„) â†’ Î“ âŠ¢ Ï„ })
   Î»2-â‰…IDesc = record
     { W = Î»2D
     , â‰…-transitive (â‰…-symmetric â‰…lift)
       (record { from = fromÎ»2
               ; to   = toÎ»2
               ; isoâ‚ = Î»2-isoâ‚
               ; isoâ‚‚ = Î»2-isoâ‚‚
               })
     }

  genId : ğ”¾ Id
  genId = â¦‡ â„•.zero â¦ˆ âˆ¥ â¦‡ â„•.suc Î¼B â¦ˆ

  genğ•‹ : ğ”¾ ğ•‹
  genğ•‹ = â¦‡ `` (` genId) â¦ˆ
        âˆ¥ â¦‡ Î¼B `â†’ Î¼B â¦ˆ
        âˆ¥ â¦‡ `âˆ€ (` genId) Â· Î¼B â¦ˆ

  Î»2M : (ix : Ctx Ã— ğ•‹) â†’ IDescM ğ”¾ (func.out Î»2D ix)
  Î»2M = Î» { (Î“ , Ï„) â†’ `Ïƒ~ (
    Î» { âˆ™            â†’ `Î£~ {!!} Î» s â†’ `1~
       ; (â–» âˆ™)       â†’ `Î£~ genğ•‹ Î» s â†’ `var~ `Ã—~ `var~
       ; (â–» â–» âˆ™)     â†’ `Î£~ {!!} Î» { (_ , refl) â†’ `Î£~ genId (Î» _ â†’ `var~) }
       ; (â–» â–» â–» âˆ™)   â†’ `Î£~ {!!} Î» { (_ , refl) â†’ `var~ }
       ; (â–» â–» â–» â–» âˆ™) â†’ `Î£~ {!!} Î» { (_ , refl) â†’ `Î£~ {!!} Î» _ â†’ `var~ } 
    })}
